<app-menu></app-menu>
<div class="body">
  <p class="header">Ordens de Serviço</p>
  <p-card>
    <div class="header-table">
      <button
        pButton
        pRipple
        icon="pi pi-refresh"
        (click)="getOrdemServico()"
        label="Atualizar"
      ></button>
      <button
        pButton
        pRipple
        icon="pi pi-plus"
        label="Adicionar Ordem de Serviço"
        class="p-button-success"
        (click)="openDialog()"
      ></button>
    </div>
    <p-table
      [value]="dados"
      [paginator]="true"
      [rows]="5"
      [rowsPerPageOptions]="[5, 10, 20]"
      [globalFilterFields]="[
        'id',
        'equipament.number',
        'orderStatus',
        'requestedServicesDescription',
        'requester.name',
        'issueDate'
      ]"
      autoLayout="true"
    >
      <ng-template pTemplate="header">
        <tr>
          <th pSortableColumn="id">ID <p-sortIcon field="id" /></th>
          <th pSortableColumn="equipament.number">
            Equipamento <p-sortIcon field="equipament.number" />
          </th>
          <th pSortableColumn="orderStatus">
            Status <p-sortIcon field="orderStatus" />
          </th>
          <th pSortableColumn="requestedServicesDescription">
            Descrição dos Serviços
            <p-sortIcon field="requestedServicesDescription" />
          </th>
          <th pSortableColumn="requester.name">
            Solicitante <p-sortIcon field="requester.name" />
          </th>
          <th pSortableColumn="issueDate">
            Data de Emissão <p-sortIcon field="issueDate" />
          </th>
          <th>Opções</th>
        </tr>
        <tr>
          <th>
            <input
              pInputText
              type="text"
              (input)="applyFilter($event, 'id')"
              placeholder="Filtrar por ID"
              class="filter-input"
            />
          </th>
          <th>
            <input
              pInputText
              type="text"
              (input)="applyFilter($event, 'equipament.number')"
              placeholder="Filtrar por Equipamento"
              class="filter-input"
            />
          </th>
          <th>
            <input
              pInputText
              type="text"
              (input)="applyFilter($event, 'orderStatus')"
              placeholder="Filtrar por Status"
              class="filter-input"
            />
          </th>
          <th>
            <input
              pInputText
              type="text"
              (input)="applyFilter($event, 'requestedServicesDescription')"
              placeholder="Filtrar por Descrição"
              class="filter-input"
            />
          </th>
          <th>
            <input
              pInputText
              type="text"
              (input)="applyFilter($event, 'requester.name')"
              placeholder="Filtrar por Solicitante"
              class="filter-input"
            />
          </th>
          <th>
            <input
              pInputText
              type="text"
              (input)="applyFilter($event, 'issueDate')"
              placeholder="Filtrar por Data de Emissão"
              class="filter-input"
            />
          </th>
          <th></th>
        </tr>
      </ng-template>
      <ng-template pTemplate="body" let-item>
        <tr>
          <td>{{ item.id }}</td>
          <td>{{ item.equipament.number }}</td>
          <td>{{ item.orderStatus }}</td>
          <td>{{ item.requestedServicesDescription }}</td>
          <td>{{ item.requester.name }}</td>
          <td>{{ item.issueDate | date : "dd/MM/yyyy" }}</td>
          <td>
            <div class="d-flex">
              <button
                pButton
                icon="pi pi-check"
                class="p-button-rounded p-button-info p-button-sm"
                title="Concluir Ordem de Serviço"
                (click)="openDialog(item)"
              ></button>
            </div>
          </td>
        </tr>
      </ng-template>
    </p-table>
  </p-card>

  <p-dialog
  header="{{ dialogTitle }}"
  [(visible)]="displayDialog"
  [modal]="true"
  [closable]="false"
  [style]="{ width: '60rem' }"
  [breakpoints]="{ '1199px': '75vw', '575px': '90vw' }"
>
  <form [formGroup]="ordemServicoForm" (ngSubmit)="onSubmit()">
    <div class="criacaoFormulario">
      <div class="formulario">
        <p-dropdown
          [options]="equipamento"
          optionLabel="number"
          optionValue="id"
          formControlName="equipament"
          (onChange)="onEquipamentChange($event)"
          placeholder="Selecione um equipamento"
          pTooltip="Equipamento"
          tooltipPosition="top"
        ></p-dropdown>
      </div>
      <div class="formulario">
        <p-dropdown
          [options]="user"
          optionLabel="name"
          optionValue="id"
          formControlName="requester"
          (onChange)="onRequesterChange($event)"
          pTooltip="Selecione um solicitante"
          tooltipPosition="top"
          placeholder="Selecione um solicitante"
        ></p-dropdown>
      </div>
      <div class="formulario">
        <p-dropdown
          [options]="mecanicos"
          formControlName="responsibleMechanics"
          placeholder="Selecione os Mecânicos Responsáveis"
          pTooltip="Mecânicos Responsáveis"
          tooltipPosition="top"
        ></p-dropdown>
      </div>
    </div>
    <div class="criacaoFormulario">
      <div class="formulario">
        <input
          pInputText
          id="orderStatus"
          class="flex-auto"
          formControlName="orderStatus"
          autocomplete="off"
          placeholder="Status"
          pTooltip="Status"
          tooltipPosition="top"
        />
      </div>
      <div class="formulario">
        <input
          pInputText
          id="maintenanceLocation"
          class="flex-auto"
          formControlName="maintenanceLocation"
          autocomplete="off"
          placeholder="Local de Manutenção"
          pTooltip="Local de Manutenção"
          tooltipPosition="top"
        />
      </div>
      <div class="formulario">
        <input
          pInputText
          id="hourMeter"
          class="flex-auto"
          formControlName="hourMeter"
          autocomplete="off"
          type="number"
          placeholder="Horímetro"
          pTooltip="Horímetro"
          tooltipPosition="top"
        />
      </div>
    </div>
    <div class="criacaoFormulario">
      <div class="formulario">
        <input
          pInputText
          id="requestedServicesDescription"
          class="flex-auto"
          formControlName="requestedServicesDescription"
          autocomplete="off"
          placeholder="Descrição dos Serviços"
          pTooltip="Descrição dos Serviços"
          tooltipPosition="top"
        />
      </div>
      <div class="formulario">
        <input
          pInputText
          id="completedServicesDescription"
          class="flex-auto"
          formControlName="completedServicesDescription"
          autocomplete="off"
          placeholder="Descrição dos Serviços Completados"
          pTooltip="Descrição dos Serviços Completados"
          tooltipPosition="top"
        />
      </div>
      <div class="formulario">
        <input
          pInputText
          id="pendingServicesDescription"
          class="flex-auto"
          formControlName="pendingServicesDescription"
          autocomplete="off"
          placeholder="Descrição dos Serviços Pendentes"
          pTooltip="Descrição dos Serviços Pendentes"
          tooltipPosition="top"
        />
      </div>
    </div>

    <h3>Informações sobre fechamento da O.S</h3>

    <div formGroupName="closing">
      <div class="criacaoFormulario">
        <div class="formulario">
          <p-dropdown
            [options]="user"
            optionLabel="name"
            optionValue="id"
            formControlName="responsible"
            placeholder="Selecione o Responsável"
            pTooltip="Responsável"
            tooltipPosition="top"
          ></p-dropdown>
        </div>
        <div class="formulario">
          <input
            pInputText
            id="total"
            class="flex-auto"
            formControlName="total"
            autocomplete="off"
            type="number"
            placeholder="Total"
            pTooltip="Total"
            tooltipPosition="top"
            [disabled]="true"
          />
        </div>
      </div>
      <div class="criacaoFormulario">
        <div class="formulario">
          <input
            pInputText
            id="quantity15w40"
            class="flex-auto"
            formControlName="quantity15w40"
            autocomplete="off"
            type="number"
            placeholder="Quantidade 15w40"
            pTooltip="Quantidade 15w40"
            tooltipPosition="top"
          />
        </div>
        <div class="formulario">
          <input
            pInputText
            id="quantityAw68"
            class="flex-auto"
            formControlName="quantityAw68"
            autocomplete="off"
            type="number"
            placeholder="Quantidade Aw68"
            pTooltip="Quantidade Aw68"
            tooltipPosition="top"
          />
        </div>
        <div class="formulario">
          <input
            pInputText
            id="quantity428"
            class="flex-auto"
            formControlName="quantity428"
            autocomplete="off"
            type="number"
            placeholder="Quantidade 428"
            pTooltip="Quantidade 428"
            tooltipPosition="top"
          />
        </div>
      </div>
      <div class="criacaoFormulario">
        <div class="formulario">
          <input
            pInputText
            id="quantity80W"
            class="flex-auto"
            formControlName="quantity80W"
            autocomplete="off"
            type="number"
            placeholder="Quantidade 80W"
            pTooltip="Quantidade 80W"
            tooltipPosition="top"
          />
        </div>
        <div class="formulario">
          <input
            pInputText
            id="quantity85w90"
            class="flex-auto"
            formControlName="quantity85w90"
            autocomplete="off"
            type="number"
            placeholder="Quantidade 85w90"
            pTooltip="Quantidade 85w90"
            tooltipPosition="top"
          />
        </div>
        <div class="formulario">
          <input
            pInputText
            id="laborValue"
            class="flex-auto"
            formControlName="laborValue"
            autocomplete="off"
            type="number"
            placeholder="Valor da Mão de Obra"
            pTooltip="Valor da Mão de Obra"
            tooltipPosition="top"
          />
        </div>
      </div>
      <div class="criacaoFormulario">
        <div class="formulario">
          <input
            pInputText
            id="transportation"
            class="flex-auto"
            formControlName="transportation"
            autocomplete="off"
            type="number"
            placeholder="Transporte"
            pTooltip="Transporte"
            tooltipPosition="top"
          />
        </div>
        <div class="formulario">
          <input
            pInputText
            id="thirdParties"
            class="flex-auto"
            formControlName="thirdParties"
            autocomplete="off"
            type="number"
            placeholder="Terceiros"
            pTooltip="Terceiros"
            tooltipPosition="top"
          />
        </div>
        <div class="formulario">
          <input
            pInputText
            id="oils"
            class="flex-auto"
            formControlName="oils"
            autocomplete="off"
            type="number"
            placeholder="Óleos"
            pTooltip="Óleos"
            tooltipPosition="top"
          />
        </div>
      </div>
    </div>
    <div class="buttons">
      <p-button
        label="Cancelar"
        severity="danger"
        (click)="displayDialog = false"
      ></p-button>
      <p-button
        class="button-salvar"
        label="Salvar"
        type="submit"
        [disabled]="ordemServicoForm.invalid"
      ></p-button>
    </div>
  </form>
</p-dialog>
</div>

<div class="card flex justify-content-center gap-2">
  <p-toast></p-toast>
  <p-confirmDialog></p-confirmDialog>
</div>
